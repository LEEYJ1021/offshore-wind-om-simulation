# Offshore Wind O&M Simulation
## Hierarchical Maintenance Decision Process (HMDP) + Greedy Scheduling with Empirical Weather Data

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![R](https://img.shields.io/badge/R-4.3%2B-276DC3?logo=r)](https://www.r-project.org/)
[![Python](https://img.shields.io/badge/Python-3.10%2B-3776AB?logo=python)](https://www.python.org/)
[![Version](https://img.shields.io/badge/Simulation--brightgreen)](scripts/02_om_simulation.py)

---

## Overview

This repository contains the full analysis pipeline for an offshore wind turbine operations & maintenance (O&M) simulation study conducted for the **Ulsan Offshore Wind Farm** (South Korea), covering the period **2023–2025** across **50 turbines** (DTU 10MW reference class).

The study integrates:
- **Empirical hourly/daily/weekly marine weather data** from Ulsan offshore station
- **HMDP (Hierarchical Maintenance Decision Process)** with Condition-Based Maintenance (CBM)
- **Greedy maintenance scheduling** with weather-routing and multi-port dispatch
- **Weibull failure modelling** with 18 component types and granular ETA (output derating) tables
- **Imperfect repair feedback loop**: post-repair effective-age update → Weibull hazard recalibration → dynamic greedy prioritisation

---

## Repository Structure

```
offshore-wind-om-simulation/
│
├── README.md
├── LICENSE
│
├── data/
│   ├── raw/
│   │   ├── weather_hourly_raw.csv          ← Raw hourly weather (place input here)
│   │   └── weekly_cost_baseline.csv        ← Weekly O&M cost baseline (LP reference)
│   ├── processed/                          ← Auto-generated by R preprocessing script
│   │   ├── ulsan_hourly_weather_simple.csv
│   │   ├── ulsan_hourly_weather_detailed.csv
│   │   ├── ulsan_daily_weather_simple.csv
│   │   ├── ulsan_daily_weather_detailed.csv
│   │   ├── ulsan_weekly_weather_simple.csv
│   │   └── ulsan_weekly_weather_detailed.csv
│   └── outputs/                            ← Statistical tables from R
│       ├── Table1_Seasonal_Statistics.csv
│       ├── Table1b_Daily_Seasonal_Statistics.csv
│       ├── Table1c_Hourly_Seasonal_Statistics.csv
│       ├── Table1d_Hourly_TimeOfDay_Statistics.csv
│       ├── Table1e_Hourly_ByHour_Statistics.csv
│       ├── Table2_Weather_Transition_Matrix.csv
│       ├── Table3_Accessibility_Summary.csv
│       └── Table3b_Daily_Accessibility_Summary.csv
│
├── scripts/
│   ├── 01_weather_preprocessing.R          ← R: hourly → daily → weekly aggregation + figures
│   └── 02_om_simulation.py                 ← Python: HMDP-Greedy O&M simulation ()
│
└── results/
    ├── figures_R/                          ← PNG figures (R)
    │   ├── Fig01_Weather_Trends_Enhanced.png
    │   ├── Fig02_Seasonal_Distributions_Enhanced.png
    │   ├── Fig03_Comprehensive_Analysis_Fixed.png
    │   ├── Fig04_Transition_Matrix_Enhanced.png
    │   ├── Fig05_Monthly_Patterns_Enhanced.png
    │   ├── Fig06_Daily_CTV_Accessibility_Heatmap.png
    │   ├── Fig07_Hourly_WindWave_ByHour.png
    │   ├── Fig08_Hourly_CTV_ByHour_Season.png
    │   ├── Fig09_Hourly_Heatmap_Month_x_Hour.png
    │   └── Fig10_Hourly_TimeOfDay_Season.png
    ├── figures_PY/                         ← PNG figures (Python, )
    │   ├── Fig01_Weather_Overview.png
    │   ├── Fig02_Seasonal_Accessibility.png
    │   ├── Fig03_ComponentCriticality_Weibull.png
    │   ├── Fig04_Strategy_Comparison.png
    │   ├── Fig05_Availability_Decomposition.png
    │   ├── Fig06_HMDP_LP_Integration.png
    │   ├── Fig07_CBM_vs_FixedPM.png
    │   ├── Fig08_Baseline_Comparison.png
    │   ├── Fig09_Scenario_Sensitivity.png
    │   ├── Fig10_Carbon_Pareto.png
    │   ├── Fig11_ETA_Derating_Analysis.png
    │   ├── Fig12_Feedback_Loop_Analysis.png
    │   └── Fig13_Empirical_Validation.png
    ├── tables/                             ← Summary tables from Python simulation
    │   ├── kpis_annual.csv
    │   ├── bootstrap_ci.csv
    │   ├── delay_kpi.csv
    │   ├── cost_breakdown.csv
    │   └── stat_tests.csv
    └── csv/                                ← Full daily/event logs per strategy
        ├── daily_S1_NoWeather.csv
        ├── daily_S2_WeatherCTV.csv
        ├── daily_S3_MultiPort.csv
        ├── daily_HMDP_CBM.csv
        ├── completed_S1_NoWeather.csv
        ├── completed_S2_WeatherCTV.csv
        ├── completed_S3_MultiPort.csv
        ├── completed_HMDP_CBM.csv
        ├── feedback_S1_NoWeather.csv
        ├── feedback_S2_WeatherCTV.csv
        ├── feedback_S3_MultiPort.csv
        └── feedback_HMDP_CBM.csv
```

---

## Data

### Input Files (place in `data/raw/`)

| File | Description | Rows | Frequency |
|------|-------------|------|-----------|
| `weather_hourly_raw.csv` | Ulsan offshore station — wind, wave, temperature, pressure | ~25,190 | Hourly |
| `weekly_cost_baseline.csv` | Weekly O&M cost baseline (LP scheduling reference) | 52 | Weekly |

> **Note:** The raw data files are not included in this repository due to data-sharing restrictions. Contact the corresponding author for access. The simulation will automatically fall back to a Markov-chain synthetic weather generator if no input file is found.

#### `weather_hourly_raw.csv` — Column Schema

| Column | Unit | Description |
|--------|------|-------------|
| `지점` / `station` | ID | Weather station identifier |
| `일시` / `datetime` | YYYY-MM-DD HH:MM | Timestamp (Asia/Seoul) |
| `풍속(m/s)` | m/s | Mean wind speed |
| `풍향(deg)` | ° | Wind direction |
| `GUST풍속(m/s)` | m/s | Maximum gust speed |
| `현지기압(hPa)` | hPa | Atmospheric pressure |
| `습도(%)` | % | Humidity |
| `기온(°C)` | °C | Air temperature |
| `수온(°C)` | °C | Sea surface temperature |
| `최대파고(m)` | m | Maximum wave height |
| `유의파고(m)` | m | Significant wave height (Hs) |
| `평균파고(m)` | m | Mean wave height |
| `파주기(sec)` | s | Wave period |
| `파향(deg)` | ° | Wave direction |

#### `weekly_cost_baseline.csv` — Column Schema

| Column | Type | Description |
|--------|------|-------------|
| `week_num` | int | ISO week index (1–52) |
| `week_label` | string | Week start–end date label |
| `ShipCost` | KRW | Vessel operating cost |
| `PortCost` | KRW | Port usage cost |
| `LaborCost` | KRW | Labour cost |
| `DowntimeCost` | KRW | Idle/non-operational cost |
| `PartsCost` | KRW | Maintenance parts cost |
| `TotalCost` | KRW | Total weekly O&M cost |

### Processed / Output Files (auto-generated)

All processed datasets and result tables are generated automatically by running the scripts. See the repository structure above for expected output locations.

---

## Scripts

### `scripts/01_weather_preprocessing.R`

**Purpose:** Processes raw hourly marine weather data into hourly, daily, and weekly aggregated datasets, computes accessibility indicators, and generates publication-quality figures (Figs 1–10 R).

**Key steps:**
1. Load and rename raw columns
2. Outlier removal (5×MAD rule) + linear interpolation for gaps
3. Compute `ctv_accessible` (Hs ≤ 1.5 m AND wind ≤ 10 m/s) and `sov_accessible` (Hs ≤ 2.5 m)
4. Aggregate to daily (mean/max/percentile statistics) and weekly (ISO week)
5. Compute seasonal statistics, Markov transition matrix, and accessibility summaries
6. Save 6 processed datasets + 8 statistical tables + 10 figures

**Run:**
```r
# From repo root or RStudio
source("scripts/01_weather_preprocessing.R")
```

**Dependencies:**
```r
install.packages(c("tidyverse", "lubridate", "data.table", "ggplot2",
                   "patchwork", "scales", "viridis", "gridExtra", "zoo"))
```

---

### `scripts/02_om_simulation.py`

**Purpose:** Runs the full HMDP + Greedy O&M simulation () for 4 maintenance strategies over 3 years (2023–2025), computes KPIs with bootstrap CIs, statistical tests, and generates Figs 1–13 + all CSV outputs.

**Strategies simulated:**

| ID | Label | Vessel | Weather | PM Mode |
|----|-------|--------|---------|---------|
| S1 | Fixed PM / No Weather | CTV only | ✗ | Fixed schedule (+ charter fee when idle) |
| S2 | Fixed PM / Weather-Aware | CTV + SOV | ✓ | Fixed schedule |
| S3 | Multi-Port / Weather | CTV + SOV | ✓ | Fixed schedule |
| S4 | **HMDP: CBM + Hierarchical Greedy** | CTV + SOV | ✓ | **CBM (Weibull)** |

**Key modelling features:**
- **18 component types** with empirical failure rate distributions (Minor / Major Repair / Replacement)
- **Weibull hazard model** (β = 2.5, η = 80 weeks) driving CBM trigger thresholds
- **Granular ETA derating table** (54 component × severity cells): partial production loss per failure state
- **Imperfect repair model**: restoration factor RF ∈ {0.35, 0.55, 0.90} by repair severity
- **Explicit feedback loop**: `apply_repair()` → effective age update → Weibull hazard recalculation → dynamic greedy priority
- ** CBM queue controls**: threshold lowered (Cr 72%, Se 65%, No 55%), 60-day minimum visit interval, daily CBM cap of 5, `cbm_queued_comps` deduplication
- **`pending_downtime_cost`** (): opportunity cost while in repair queue = criticality × ETA × wait hours × unit penalty; distinct from `downtime_cost` (actual wind-based production loss)
- **S1 charter fee** (): CTV daily rate (₩3,500,000) + idle fuel charged on no-departure days
- **Bootstrap 95% CI** for weekly cost KPIs (300 resamples)
- **Mann-Whitney U + Welch t-test + Cohen's d** for pairwise HMDP vs baseline comparisons

**Run:**
```bash
cd repo
python scripts/02_om_simulation.py
```

**Dependencies:**
```bash
pip install numpy pandas matplotlib scipy
```

**Weather data fallback:** If no empirical CSV is found, the script automatically generates synthetic weather using a Markov chain calibrated to the Ulsan seasonal statistics (7-state seasonal means from empirical dataset).

---

## Key Results (, Simulated 2023–2025)

### 3-Year Aggregate KPIs

| Strategy | 3Y Total Cost | 3Y O&M Cost | AO (%) | AEP (%) | Total Failures | CO₂ (tCO₂) |
|----------|:------------:|:-----------:|:------:|:-------:|:--------------:|:-----------:|
| S1: Fixed PM / No Weather | ₩39.3B | ₩15.6B | 98.7% | 83.5% | 965 | 79.7 |
| S2: Fixed PM / Weather-Aware | ₩31.5B | ₩27.1B | 99.4% | 92.2% | 1,073 | 173.5 |
| S3: Multi-Port / Weather | ₩31.9B | ₩27.7B | 99.3% | 92.3% | 1,036 | 175.1 |
| **S4: HMDP CBM** | **₩43.4B** | **₩30.1B** | **99.9%** | **87.9%** | **592** | **206.1** |

> **Interpretation:** HMDP achieves the highest operational availability (99.9%) and lowest critical failure count (137 vs 332–360 for baselines), at the cost of higher total expenditure driven by proactive SOV deployment and CBM overhead. S2 and S3 offer the best AEP (≥92%) and lowest total cost (≈₩31.5B) through weather-aware scheduling without full CBM. S1's low O&M cost (₩15.6B) is illusory — ₩23.7B in downtime losses (57.8% of total spend) result from unattended failures.

### Annual KPI Breakdown

| Strategy | Year | Total Cost | O&M Cost | AO (%) | AEP (%) | Failures | Critical Fails | PDC (B₩) | Charter (M₩) |
|----------|------|:----------:|:--------:|:------:|:-------:|:--------:|:--------------:|:---------:|:------------:|
| S1 | 2023 | ₩2.7B | ₩2.4B | 99.8% | 93.6% | 173 | 62 | ₩0.11B | ₩488M |
| S1 | 2024 | ₩12.4B | ₩6.0B | 97.6% | 86.9% | 370 | 132 | ₩1.93B | ₩713M |
| S1 | 2025 | ₩24.1B | ₩7.1B | 98.8% | 69.8% | 422 | 150 | ₩2.85B | ₩563M |
| S2 | 2023 | ₩4.5B | ₩4.2B | 99.8% | 93.7% | 160 | 56 | ₩0.11B | — |
| S2 | 2024 | ₩12.4B | ₩11.2B | 99.4% | 92.9% | 410 | 128 | ₩0.31B | — |
| S2 | 2025 | ₩14.6B | ₩11.7B | 99.0% | 90.1% | 503 | 176 | ₩0.79B | — |
| S3 | 2023 | ₩5.9B | ₩5.3B | 99.6% | 93.3% | 173 | 67 | ₩0.35B | — |
| S3 | 2024 | ₩11.8B | ₩10.8B | 99.5% | 93.1% | 368 | 130 | ₩0.38B | — |
| S3 | 2025 | ₩14.2B | ₩11.6B | 98.9% | 90.5% | 495 | 161 | ₩0.76B | — |
| **HMDP** | 2023 | **₩8.6B** | **₩8.2B** | **99.9%** | **93.4%** | **146** | **43** | **₩0.12B** | — |
| **HMDP** | 2024 | **₩16.7B** | **₩11.5B** | **99.8%** | **87.5%** | **222** | **45** | **₩0.54B** | — |
| **HMDP** | 2025 | **₩18.1B** | **₩10.4B** | **99.9%** | **82.6%** | **224** | **49** | **₩0.41B** | — |

*PDC = pending_downtime_cost (queue-wait opportunity penalty). Charter = wasted CTV charter fee on no-departure days (S1 only,  addition).*

### Cost Component Share (3-Year Total)

| Strategy | Ship | Port | Labor | PDC | Parts | Downtime | Charter | Total |
|----------|:----:|:----:|:-----:|:---:|:-----:|:--------:|:-------:|------:|
| S1 | 13.7% | 3.9% | 1.6% | 11.9% | 6.9% | 57.8% | 4.3% | ₩41.1B |
| S2 | 62.0% | 6.5% | 2.6% | 3.8% | 11.0% | 13.9% | 0.0% | ₩31.5B |
| S3 | 62.2% | 6.5% | 2.7% | 4.6% | 11.0% | 13.1% | 0.0% | ₩31.9B |
| **HMDP** | **53.3%** | **5.8%** | **1.7%** | **2.5%** | **6.1%** | **30.7%** | **0.0%** | **₩43.4B** |

### Statistical Testing (HMDP vs Baselines)

| Comparison | HMDP μ (M₩/wk) | Comp μ (M₩/wk) | MWU p-value | Welch p-value | Cohen's d | Effect |
|---|:---:|:---:|:---:|:---:|:---:|:---:|
| HMDP vs S1 | 835.1 | 755.5 | 0.073 | 0.194 | 0.259 | small (n.s.) |
| HMDP vs S2 | 835.1 | 605.0 | **0.00002** | **0.00001** | 0.933 | **large (***)** |
| HMDP vs S3 | 835.1 | 613.4 | **0.00004** | **0.00006** | 0.833 | **large (***)** |

> HMDP incurs statistically significantly higher weekly costs than S2 and S3 (p < 0.001, Cohen |d| > 0.8), reflecting its proactive SOV deployment and CBM overhead. The HMDP–S1 comparison is not statistically significant (p = 0.073) because S1's extreme downtime spikes inflate variance, masking the directional cost difference.

### Delay-Based Availability (FAIL Events Only)

| Strategy | FAIL Tasks | Mean Delay (d) | Turbine AO (delay-based) | Note |
|----------|:----------:|:--------------:|:------------------------:|------|
| S1 | 709 | 34.0 | 56.0% | High queue backlog from weather-blind scheduling |
| S2 | 977 | 8.7 | 84.4% | Weather-aware routing drastically reduces wait |
| S3 | 927 | 7.6 | 87.1% | Multi-port adds marginal improvement over S2 |
| HMDP | 353 | 32.0 | 79.4% | Fewer failures but CBM queue competition delays FAIL repairs |

*PM and CBM_PM delay values represent queue wait time only, not actual downtime — turbine AO is N/A for these task types.*

---

## Figures

### R-Generated (Weather Analysis)

| Figure | Description |
|--------|-------------|
| Fig01 | Enhanced weather trends — wind speed, wave height, pressure time series |
| Fig02 | Seasonal distributions — boxplots and density plots |
| Fig03 | Comprehensive metocean analysis |
| Fig04 | Weather state transition matrix (Markov) |
| Fig05 | Monthly patterns — seasonal cycle decomposition |
| Fig06 | Daily CTV accessibility heatmap (month × day-of-week) |
| Fig07 | Hourly wind and wave by time-of-day |
| Fig08 | Hourly CTV accessibility by hour and season |
| Fig09 | Hourly heatmap (month × hour) |
| Fig10 | Hourly time-of-day patterns by season |

### Python-Generated (Simulation Analysis, )

| Figure | Description |
|--------|-------------|
| **Fig01** | Ulsan metocean overview 2023–2025: wind speed, significant wave height, weather scenario classification + CTV accessibility 7-day MA |
| **Fig02** | Seasonal weather distribution and vessel accessibility: wind/wave boxplots + CTV vs SOV access rates by season |
| **Fig03** | Component criticality and Weibull failure model: hazard curves,  CBM thresholds (Cr 72%/Se 65%/No 55%), risk ranking, ETA segmentation, CBM vs fixed PM logic, optimal threshold cost analysis |
| **Fig04** | Strategy comparison: operational AO, energy AEP, cost decomposition (with PDC and wasted charter), rolling cost time series, critical vs non-critical failure counts |
| **Fig05** | Availability decomposition: monthly AO/AEP trajectories, daily AO violin plots, cost–AO Pareto scatter |
| **Fig06** | HMDP-Greedy integration: weather scenario → CAP_HR + deferral, cost improvement vs S1, maintenance queue evolution ( normalised), risk–cost tradeoff (mean vs 95% VaR) |
| **Fig07** | CBM vs fixed PM analysis: monthly PM event counts, critical failure trends, deferral impact on AO, PM vs downtime cost comparison |
| **Fig08** | Simulation vs LP baseline (2025): weekly O&M cost, cumulative cost trajectory, gap analysis, risk–cost scatter |
| **Fig09** | Scenario and sensitivity analysis: daily cost by weather state (S1 includes idle charter fee), AO by weather state, tornado sensitivity diagram, monthly pending downtime penalty |
| **Fig10** | Carbon–availability Pareto: seasonal CO₂ vs AO scatter, monthly carbon footprint by strategy |
| **Fig11** | ETA derating analysis: 54-cell component × severity output loss matrix, AEP granular vs conservative ETA, daily energy loss distribution (HMDP), ETA by criticality level |
| **Fig12** | Feedback loop analysis: imperfect repair age update scatter, post-repair Weibull hazard reduction histograms, dynamic vs static priority task completion, repair frequency by component ( normalised) |
| **Fig13** | Empirical validation: FAIL delay distribution, delay-based turbine availability, statistical test p-values, Cohen's d effect sizes, cost decomposition validation (PDC + charter included),  modification summary |

---

## Simulation Parameters

| Parameter | Value |
|-----------|-------|
| Turbines | 50 × DTU 10MW |
| Simulation period | 2023-01-01 – 2025-12-31 |
| Location | Ulsan offshore, South Korea |
| Random seed | 42 |
| CTV operational limits | Wind ≤ 10 m/s, Hs ≤ 1.5 m |
| SOV operational limits | Hs ≤ 2.5 m |
| Electricity price | 155,500 KRW/MWh (incl. REC) |
| Operational hours / day | 12 h |
| Weibull shape β | 2.5 |
| Weibull scale η | 80 weeks |
| **CBM threshold — Critical** | **R(t) < 72%** *(, lowered from 88%)* |
| **CBM threshold — Semi-Critical** | **R(t) < 65%** *(, lowered from 82%)* |
| **CBM threshold — Non-Critical** | **R(t) < 55%** *(, lowered from 75%)* |
| CBM min visit interval | 60 days *()* |
| Max CBM PM per day | 5 tasks *()* |
| Restoration factor — Minor Repair | RF = 0.35 |
| Restoration factor — Major Repair | RF = 0.55 |
| Restoration factor — Major Replacement | RF = 0.90 |
| CTV charter fee (idle days) | ₩3,500,000 / day *(, S1 only)* |
| SOV charter fee (idle days) | ₩35,000,000 / day *(, reference)* |
| Port P1 distance | 10.0 km |
| Port P2 distance | 15.0 km |

---

## Cost Terminology ()

| Term | Definition |
|------|-----------|
| `ship_cost` | Fuel + travel cost per vessel per working day |
| `port_cost` | Port usage fee proportional to working hours |
| `labor_cost` | Crew hourly wage × crew teams × working hours |
| `pending_downtime_cost` (PDC) | Queue-wait opportunity cost: criticality weight × ETA × waiting hours × unit penalty rate. **Not** a direct production loss — reflects economic urgency of unserved tasks |
| `parts_cost` | Component-level spare parts expenditure |
| `downtime_cost` | Actual lost production revenue: `(max_possible_MWh − actual_MWh) × electricity_price × wind_fraction`. Computed from power curve, wind speed, and ETA derating |
| `wasted_charter_cost` | CTV daily charter fee charged on no-departure days when weather blocks S1 *(, S1 only)* |

---

## License

This project is licensed under the MIT License — see [LICENSE](LICENSE) for details.
